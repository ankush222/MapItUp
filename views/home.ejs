<html>
	<head>
		<link rel="stylesheet" type="text/css" href="css/home.css">
		<link rel="stylesheet" type="text/css" href="css/navbar.css">
		<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	    <script type="text/javascript">
	      var fav = "";
	      var countries = <%-JSON.stringify(countries)%>;
	      var favorites = <%-JSON.stringify(favorites)%>;
	      var userId = <%-JSON.stringify(userId)%>;
	      var favorites = <%-JSON.stringify(favorites)%>;
	      // alert(userId);
	      google.charts.load('upcoming', {'packages':['geochart']});
	      google.charts.setOnLoadCallback(drawRegionsMap);
	      var size = countries.length;
	      function drawRegionsMap() {
	        var dataTable2 = new google.visualization.DataTable();
	        dataTable2.addColumn('string', 'Country');
	        dataTable2.addColumn('number', 'Color');
	        // A column for custom tooltip content
	        // dataTable2.addColumn({type: 'string', role: 'tooltip'});
	        dataTable2.addRows([
				['AC',0 ],
			    ['AD',0 ],
			    ['AE',0 ],
			    ['AF',0 ],
			    ['AG',0 ],
			    ['AI',0 ],
			    ['AL',0 ],
			    ['AM',0 ],
			    ['AN',0 ],
			    ['AO',0 ],
			    ['AQ',0 ],
			    ['AR',0 ],
			    ['AS',0 ],
			    ['AT',0 ],
			    ['AU',0 ],
			    ['AW',0 ],
			    ['AX',0 ],
			    ['AZ',0 ],
			    ['BA',0 ],
			    ['BB',0 ],
			    ['BD',0 ],
			    ['BE',0 ],
			    ['BF',0 ],
			    ['BG',0 ],
			    ['BH',0 ],
			    ['BI',0 ],
			    ['BJ',0 ],
			    ['BM',0 ],
			    ['BN',0 ],
			    ['BO',0 ],
			    ['BR',0 ],
			    ['BS',0 ],
			    ['BT',0 ],
			    ['BV',0 ],
			    ['BW',0 ],
			    ['BY',0 ],
			    ['BZ',0 ],
			    ['CA',0 ],
			    ['CC',0 ],
			    ['CD',0 ],
			    ['CF',0 ],
			    ['CG',0 ],
			    ['CH',0 ],
			    ['CI',0 ],
			    ['CK',0 ],
			    ['CL',0 ],
			    ['CM',0 ],
			    ['CN',0 ],
			    ['CO',0 ],
			    ['CR',0 ],
			    ['CS',0 ],
			    ['CU',0 ],
			    ['CV',0 ],
			    ['CX',0 ],
			    ['CY',0 ],
			    ['CZ',0 ],
			    ['DE',0 ],
			    ['DJ',0 ],
			    ['DK',0 ],
			    ['DM',0 ],
			    ['DO',0 ],
			    ['DZ',0 ],
			    ['EC',0 ],
			    ['EE',0 ],
			    ['EG',0 ],
			    ['EH',0 ],
			    ['ER',0 ],
			    ['ES',0 ],
			    ['ET',0 ],
			    ['EU',0 ],
			    ['FI',0 ],
			    ['FJ',0 ],
			    ['FK',0 ],
			    ['FM',0 ],
			    ['FO',0 ],
			    ['FR',0 ],
			    ['FX',0 ],
			    ['GA',0 ],
			    ['GB',0 ],
			    ['GD',0 ],
			    ['GE',0 ],
			    ['GF',0 ],
			    ['GG',0 ],
			    ['GH',0 ],
			    ['GI',0 ],
			    ['GL',0 ],
			    ['GM',0 ],
			    ['GN',0 ],
			    ['GP',0 ],
			    ['GQ',0 ],
			    ['GR',0 ],
			    ['GS',0 ],
			    ['GT',0 ],
			    ['GU',0 ],
			    ['GW',0 ],
			    ['GY',0 ],
			    ['HK',0 ],
			    ['HM',0 ],
			    ['HN',0 ],
			    ['HR',0 ],
			    ['HT',0 ],
			    ['HU',0 ],
			    ['ID',0 ],
			    ['IE',0 ],
			    ['IL',0 ],
			    ['IM',0 ],
			    ['IN',0 ],
			    ['IO',0 ],
			    ['IQ',0 ],
			    ['IR',0 ],
			    ['IS',0 ],
			    ['IT',0 ],
			    ['JE',0 ],
			    ['JM',0 ],
			    ['JO',0 ],
			    ['JP',0 ],
			    ['KE',0 ],
			    ['KG',0 ],
			    ['KH',0 ],
			    ['KI',0 ],
			    ['KM',0 ],
			    ['KN',0 ],
			    ['KP',0 ],
			    ['KR',0 ],
			    ['KW',0 ],
			    ['KY',0 ],
			    ['KZ',0 ],
			    ['LA',0 ],
			    ['LB',0 ],
			    ['LC',0 ],
			    ['LI',0 ],
			    ['LK',0 ],
			    ['LR',0 ],
			    ['LS',0 ],
			    ['LT',0 ],
			    ['LU',0 ],
			    ['LV',0 ],
			    ['LY',0 ],
			    ['MA',0 ],
			    ['MC',0 ],
			    ['MD',0 ],
			    ['ME',0 ],
			    ['MG',0 ],
			    ['MH',0 ],
			    ['MK',0 ],
			    ['ML',0 ],
			    ['MM',0 ],
			    ['MN',0 ],
			    ['MO',0 ],
			    ['MP',0 ],
			    ['MQ',0 ],
			    ['MR',0 ],
			    ['MS',0 ],
			    ['MT',0 ],
			    ['MU',0 ],
			    ['MV',0 ],
			    ['MW',0 ],
			    ['MX',0 ],
			    ['MY',0 ],
			    ['MZ',0 ],
			    ['NA',0 ],
			    ['NC',0 ],
			    ['NE',0 ],
			    ['NF',0 ],
			    ['NG',0 ],
			    ['NI',0 ],
			    ['NL',0 ],
			    ['NO',0 ],
			    ['NP',0 ],
			    ['NR',0 ],
			    ['NT',0 ],
			    ['NU',0 ],
			    ['NZ',0 ],
			    ['OM',0 ],
			    ['PA',0 ],
			    ['PE',0 ],
			    ['PF',0 ],
			    ['PG',0 ],
			    ['PH',0 ],
			    ['PK',0 ],
			    ['PL',0 ],
			    ['PM',0 ],
			    ['PN',0 ],
			    ['PR',0 ],
			    ['PS',0 ],
			    ['PT',0 ],
			    ['PW',0 ],
			    ['PY',0 ],
			    ['QA',0 ],
			    ['RE',0 ],
			    ['RO',0 ],
			    ['RS',0 ],
			    ['RU',0 ],
			    ['RW',0 ],
			    ['SA',0 ],
			    ['SB',0 ],
			    ['SC',0 ],
			    ['SD',0 ],
			    ['SE',0 ],
			    ['SG',0 ],
			    ['SH',0 ],
			    ['SI',0 ],
			    ['SJ',0 ],
			    ['SK',0 ],
			    ['SL',0 ],
			    ['SM',0 ],
			    ['SN',0 ],
			    ['SO',0 ],
			    ['SR',0 ],
			    ['ST',0 ],
			    ['SU',0 ],
			    ['SV',0 ],
			    ['SY',0 ],
			    ['SZ',0 ],
			    ['TC',0 ],
			    ['TD',0 ],
			    ['TF',0 ],
			    ['TG',0 ],
			    ['TH',0 ],
			    ['TJ',0 ],
			    ['TK',0 ],
			    ['TM',0 ],
			    ['TN',0 ],
			    ['TO',0 ],
			    ['TP',0 ],
			    ['TR',0 ],
			    ['TT',0 ],
			    ['TV',0 ],
			    ['TW',0 ],
			    ['TZ',0 ],
			    ['UA',0 ],
			    ['UG',0 ],
			    ['UK',0 ],
			    ['UM',0 ],
			    ['US',0 ],
			    ['UY',0 ],
			    ['UZ',0 ],
			    ['VA',0 ],
			    ['VC',0 ],
			    ['VE',0 ],
			    ['VG',0 ],
			    ['VI',0 ],
			    ['VN',0 ],
			    ['VU',0 ],
			    ['WF',0 ],
			    ['WS',0 ],
			    ['XK',0 ],
			    ['YE',0 ],
			    ['YT',0 ],
			    ['YU',0 ],
			    ['ZA',0 ],
			    ['ZR',0 ],
			    ['ZM',0 ],
			    ['ZW',0 ],
			    ['SS',0 ]
	    	]);

			for (i = 0; i < countries.length; i++) { 
				// alert("oye "+countries[i]);
				c = countries[i].replace(/['"]+/g, '');
				// alert("haha "+c);
			    dataTable2.addRows([[countries[i], -1 ]]);
			}

			for (i = 0; i < favorites.length; i++) { 
				// alert("oye "+countries[i]);
				c = favorites[i].replace(/['"]+/g, '');
				// alert("haha "+c);
			    dataTable2.addRows([[favorites[i], -0.5 ]]);
			}

		    var dataTable1 = new google.visualization.DataTable();
	        dataTable1.addColumn('string', 'Country');
	        dataTable1.addColumn('number', 'Color');
	        dataTable1.addRows([['SS',0 ]]); //added south sudan for 0 country code color
	        for (i = 0; i < countries.length; i++) { 
				// alert("oye "+countries[i]);
				c = countries[i].replace(/['"]+/g, '');
				// alert("haha "+c);
			    dataTable1.addRows([[countries[i], -1 ]]);
			}

	        var options1 = {
	        	backgroundColor: '#17263c',
	        	legend: 'none',
	        	colorAxis: {colors: ['green', 'yellow', 'grey']},
	        };

	        var chart1 = new google.visualization.GeoChart(document.getElementById('regions_div1'));
	        var chart2 = new google.visualization.GeoChart(document.getElementById('regions_div2'));

	        google.visualization.events.addListener(chart2, 'select', function() {
			    var selectionIdx = chart2.getSelection()[0].row;
			    
			    countryName = dataTable2.getValue(selectionIdx, 0);
			    c = countryName.replace(/['"]+/g, '');
			    fav = c;
			    
			    dataTable1.addRows([[c, -2]]);

			    document.getElementById("regions_div2").style.zIndex = -10;
			    document.getElementById("regions_div1").style.zIndex = 0;
			    document.getElementById("fav").style.zIndex = 10;
				var options2 = {
		          region: c, //count, // Africa
		          backgroundColor: '#17263c',
		          legend: 'none',
		          colorAxis: {colors: ['#db4025', 'green', 'grey']},
		          datalessRegionColor: 'grey'      
		        };

			    chart1.draw(dataTable1, options2);
			    chart2.setSelection(null);
			    dataTable1.addRows([[c, 0]]);

			    google.visualization.events.addListener(chart1, 'select', function() {
			    	window.open("/countries?userId="+userId+"&country="+fav, "_self");
			    });
			});

	        chart2.draw(dataTable2, options1);

	        document.getElementById("back").addEventListener("click", function(){
				document.getElementById("regions_div1").style.zIndex = -10;
				document.getElementById("regions_div2").style.zIndex = 0;
				document.getElementById("fav").style.zIndex = 0;
			});
	      }

	      function sendFav() {
	      	favForm.country.value = fav;
	      	favForm.submit();
	      	fav = "";
	      }

	    </script>
	</head>
	<body>
		<div id = 'navbar'>
			<img src="http://www.electrogarden.com/music/egn/skins/ProJam_Dark/images/world_map_black.jpg" id="logo" />
			<div id = "name">MapItUp</div>
			<ul>
			  <li><a class="active" href="/home?userId=<%- userId%>"><b>Home</b></a></li>
			  <li><a href="/profile?userId=<%- userId%>"><b>Profile</b></a></li>
			  <li><a href="#contact"><b>Followers</b></a></li>
			  <li><a href="/signOut"><b>Sign Out</b></a></li>
			  <li><form action="/search" method="post"><input id="search-bar" name="search" type="text" placeholder="Search..."><input type="hidden" name="userId" value=<%- userId%>></form></li>
			  <li><span class="icon"><i class="fa fa-search"></i></span></li>
			</ul>
		</div>
		<div class='layer'>
			<div id = 'workingArea'>
				<h1> Welcome, <%= name%></h1>
				<div id='percentage'>
					<h4>You have travelled <%=countries.length/200%> % of the world so far!</h4>
				</div>
				<form method="post" action="/addFavorite" name="favForm"><i onclick="sendFav()" id="fav" class="fa fa-star" style="font-size:60px;color:red;left:950px;top:200px; position:absolute; float:left; "></i><input type="hidden" name="country"><input type="hidden" name="userId" value=<%- userId%>></form>
				<span class="icon" style="margin-left:18px;"><i class="fa fa-search" style="font-size:23px"></i></span>
				<form name="theForm" method="post" action="/addVisited" id="addVisited"><input id="search-bar" name="country" type="text" placeholder="Which countries have you visited ?" style="width:150%;height:35px; margin-left: 50px; float:left;"><input type="hidden" name="userId" value=<%- userId%>></form>
				<div id = 'map'>
					<div id="regions_div1" style="position: absolute; width: 1000px; height: 500px; display: inline; z-index: -10"></div>
					<div id="regions_div2" style="position: absolute; width: 1000px; height: 500px;"></div>
				</div>
				<div id='back'></div>
			</div>
		</div>
	</body>
</html>